<!DOCTYPE html>
<meta charset="UTF-8">
<title>Tele2 challenge</title>
<link rel="stylesheet" type="text/css" href="style/tele2.css">
<script>

var HTML = (function (doc) {

var HTML = {};

/**
 * @param {string} tagName
 * @return {HTMLElement}
 */
HTML.createElement = function (el)
{
	return doc.createElement('el');
};

/**
 * @param {HTMLSelectElement} el
 * @param {string} value
 */
HTML.setSelectValue = function (el, value)
{
	// TODO
};

/**
 * @return {?HTMLBodyElement}
 */
HTML.getBody = function ()
{
	return doc.body || doc.getElementsByTagName("body")[0] || null;
};

return HTML;

})(document);


var Challenge = (function (HTML) {

/**
 * @param {string} url
 * @param {Object} crop
 * @return {Element}
 */
function renderImage(url, crop)
{
	new Image(uri);
}

/**
 * @constructor
 * @param {*} value
 * @param {Node} node
 */
function DataRendering(value, node)
{
	this.value = value;
	this.node = node;
}

/**
 * @param {Array.<DataRendering}
 * @return {HTMLSelectElement}
 */
function createDropdown(values, descriptions)
{
	var select = HTML.createElement("select");
	for (var i = 0, l = values.length; i < l; i++)
	{
		var option = select.option
		select.appendChild(option);
	}
}

/**
 * @param {string} url
 * @param {?Object.<string, string>} headers
 * @param {function(*)=} onload
 * @param {function(*)=} onerror
 */
function fetch(url, headers, onload, onerror)
{
	try
	{
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function ()
		{
			if (xhr.readyState === 4)
			{
				onload(xhr.responseText);
			}
		};
		xhr.open("GET", url, false);
		xhr.load();
	}
	catch (error)
	{
		if (onerror)
			onerror(error)
	}
}

/**
 * @constructor
 * @param {HTMLElement} root
 */
function ChallengeRendering(root, url)
{
	this.url = url;
	this.root = HTML.createElement("div");
	root.appendChild(root);

	this.reload();
}

ChallengeRendering.prototype.destruct = function ()
{
	if (this.root && this.root.parentNode)
		this.root.parentNode.removeChild(this.root);
};

ChallengeRendering.prototype.reload = function ()
{
	var self = this;

	/**
	 * @param {*} data
	 */
	function onload(data)
	{
		try
		{
			if (typeof data === "string")
			{
				self.data = JSON.parse(data);
				self.redraw();
				return;
			}
		}
		else
		{
			onerror(new TypeError("Response wasn't a valid JSON document"));
		}
	}

	function onerror()
	{
		self.error = new Error(this.root.innerHTML = "<p class=error>Loading this page failed. Please try again later.</p>";
	}

	fetch(this.url, { "Accept-Type": "application/json" }, onload);
};

ChallengeRendering.prototype.redraw = function ()
{
	if (this.error)
	{
		this.drawError();
	}
	else
	{
		for (var i = 0, l = this.data.length; i < l; i++)
		{
			//
		}
	}
};

ChallengeRendering.prototype.drawError = function ()
{
	// Replace any rendered content with the error message.
	this.root.innerHTML = "";
	var msg = this.root.appendChild(HTML.createElement("p"));
	msg.className = "error";
	HTML.setTextContent(msg, "" + this.error);
};

})(HTML, JSON);

new ChallengeRendering(HTML.getBody(), "script/phones.json");

</script>
<body class="tele2">
<h1>Phone offering</h1>